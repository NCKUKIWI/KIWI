<div class="modal-header">
  <button type="button" class="close" data-dismiss="modal">
    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
  </button>
  <h1 class="modal-title">新增心得</h1>
</div>
<div class="modal-body">
  <% if(user){%>
    <form class="ui form" id="createform">
      <div class="fields">
        <div class="thirteen wide field">
          <label>課程名稱:</label>
          <div class="ui search">
            <div class="ui input">
              <input class="prompt" type="text" name="course">
            </div>
            <div class="results"></div>
          </div>
        </div>
        <div class="three wide field">
          <label>學期:</label>
          <select name="semester" form="createform">
            <option value="104-2">104-2</option>
            <option value="104-1">104-1</option>
            <option value="103-2">103-2</option>
            <option value="103-1">103-1</option>
            <option value="102-2">102-2</option>
            <option value="102-1">102-1</option>
          </select>
        </div>
      </div>
      <input type="hidden" name="catalog" value="0">
      <input type="hidden" name="course_name" value="0">
      <input type="hidden" name="course_id" value="0">
      <input type="hidden" name="teacher" value="0">
      <div class="field">
        <label>修課心得:</label>
        <textarea rows="4" cols="50" name="comment" form="createform"></textarea>
      </div>
      <div class="field">
        <label>上課內容: </label>
        <textarea rows="4" cols="50" name="course_style" form="createform"></textarea>
      </div>
      <div class="field">
        <label>作業考試: </label>
        <textarea rows="4" cols="50" name="report_hw" form="createform"></textarea>
      </div>
      <div class="field">
        <div class="ui button" id="createform-submit">送出</div>
      </div>
    </form>
    <% }else{ %>
      <a class="ui button" id="createform-fblogin-btn" href="/user/auth/facebook">請先登入Facebook</a>
    <% } %>
</div>
<script>
$(document).ready(function(){
  var course = [
    <% for(var i in course){ %>
      {
        title:'<%- course[i].課程名稱 %> - <%- course[i].老師 %>',
        description:'<%- course[i].時間 %>',
        coursename:'<%- course[i].課程名稱 %>',
        courseid:'<%- course[i].id %>',
        teacher:'<%- course[i].老師 %>',
        category:'<%- course[i].系所名稱 %>',
      },
    <% } %>
  ];

  $('#createform .ui.search').search({
      source:course,
      onSelect:function(result, response){
        $('input[name=course_id]').val(result.courseid);
        $('input[name=teacher]').val(result.teacher);
        $('input[name=course_name]').val(result.coursename);
        $('input[name=catalog]').val(result.category);
      }
  });

  $('#createform-submit').on('click', function() {
    var data = $("#createform").serialize();
    $.ajax({
      url: '/post/create',
      type: 'post',
      data: data,
      success: function(response) {
        if (response == "success") {
          window.location.href = "/";
        }
        else {
          var errosbox = "<div class='ui negative message'><div class='header'>錯誤</div><ul class='list'>";
          for (var i in response) {
            var dom = "<li>" + response[i].msg + "</li>";
            errosbox += dom;
          }
          errosbox += "</ul></div>";
          $('#new .modal-body').prepend(errosbox);
          $('#new').data('bs.modal').handleUpdate();
        }
      }
    });
  });
});
</script>
