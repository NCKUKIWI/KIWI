<div class="modal-header">
  <button type="button" class="close" data-dismiss="modal">
    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
  </button>
  <h1 class="modal-title">新增心得(所有項目皆為選填)</h1>
</div>
<div class="modal-body">
    <form class="ui form" id="createform">
      <div class="partA">
        <div class="fields">
          <div class="thirteen wide field">
            <label>課程名稱:</label>
            <div class="ui search">
              <div class="ui input">
                <input class="prompt" type="text" name="course">
              </div>
              <div class="results"></div>
            </div>
          </div>
          <div class="three wide field">
            <label>學期:</label>
            <select name="semester" form="createform" style="height: 42px;">
              <option value="104-2">104-2</option>
              <option value="104-1">104-1</option>
              <option value="103-2">103-2</option>
              <option value="103-1">103-1</option>
              <option value="102-2">102-2</option>
              <option value="102-1">102-1</option>
            </select>
          </div>
        </div>
      </div>
      <input type="hidden" name="recommand" value="1">
      <input type="hidden" name="hard" value="1">
      <input type="hidden" name="sweet" value="1">
      <input type="hidden" name="catalog" value="0">
      <input type="hidden" name="course_name" value="0">
      <input type="hidden" name="course_id" value="0">
      <input type="hidden" name="teacher" value="0">
      <div class="partB">
        <div class="field">
          <label>推薦程度:</label>
          <div class="scorebar" id="recommand">
            <div class="scorebtn" style="border-left:1px solid black;" data-score="1">1</div>
            <div class="scorebtn" data-score="2">2</div>
            <div class="scorebtn" data-score="3">3</div>
            <div class="scorebtn" data-score="4">4</div>
            <div class="scorebtn" data-score="5">5</div>
            <div class="scorebtn" data-score="6">6</div>
            <div class="scorebtn" data-score="7">7</div>
            <div class="scorebtn" data-score="8">8</div>
            <div class="scorebtn" data-score="9">9</div>
            <div class="scorebtn" data-score="10">10</div>
          </div>
        </div>
        <div class="field">
          <label>課程硬度:</label>
          <div class="scorebar" id="hard">
            <div class="scorebtn" style="border-left:1px solid black;" data-score="1">1</div>
            <div class="scorebtn" data-score="2">2</div>
            <div class="scorebtn" data-score="3">3</div>
            <div class="scorebtn" data-score="4">4</div>
            <div class="scorebtn" data-score="5">5</div>
            <div class="scorebtn" data-score="6">6</div>
            <div class="scorebtn" data-score="7">7</div>
            <div class="scorebtn" data-score="8">8</div>
            <div class="scorebtn" data-score="9">9</div>
            <div class="scorebtn" data-score="10">10</div>
          </div>
        </div>
        <div class="field">
          <label>分數甜度:</label>
          <div class="scorebar" id="sweet">
            <div class="scorebtn" style="border-left:1px solid black;" data-score="1">1</div>
            <div class="scorebtn" data-score="2">2</div>
            <div class="scorebtn" data-score="3">3</div>
            <div class="scorebtn" data-score="4">4</div>
            <div class="scorebtn" data-score="5">5</div>
            <div class="scorebtn" data-score="6">6</div>
            <div class="scorebtn" data-score="7">7</div>
            <div class="scorebtn" data-score="8">8</div>
            <div class="scorebtn" data-score="9">9</div>
            <div class="scorebtn" data-score="10">10</div>
          </div>
        </div>
      </div>
      <div class="partA">
        <div class="field">
          <label>修課心得:</label>
          <textarea rows="4" cols="50" name="comment" form="createform"></textarea>
        </div>
        <div class="field">
          <label>上課內容: </label>
          <textarea rows="4" cols="50" name="course_style" form="createform"></textarea>
        </div>
        <div class="field">
          <label>作業考試: </label>
          <textarea rows="4" cols="50" name="report_hw" form="createform"></textarea>
        </div>
        <div class="field" style="text-align:center;">
          <div class="ui button" id="createform-submit">送出</div>
          <div class="ui button" data-dismiss="modal">返回</div>
        </div>
      </div>
    </form>
</div>
<script>
$(document).ready(function(){
  var course = [
    <% for(var i in course){ %>
      {
        title:'<%- course[i].課程名稱 %> - <%- course[i].老師 %>',
        description:'<%- course[i].時間 %>',
        coursename:'<%- course[i].課程名稱 %>',
        courseid:'<%- course[i].id %>',
        teacher:'<%- course[i].老師 %>',
        category:'<%- course[i].系所名稱 %>',
      },
    <% } %>
  ];

  $('#createform .ui.search').search({
      source:course,
      onSelect:function(result, response){
        $('input[name=course_id]').val(result.courseid);
        $('input[name=teacher]').val(result.teacher);
        $('input[name=course_name]').val(result.coursename);
        $('input[name=catalog]').val(result.category);
      }
  });

  $('#createform-submit').on('click', function() {
    var data = $("#createform").serialize();
    $.ajax({
      url: '/post/create',
      type: 'post',
      data: data,
      success: function(response) {
        if (response == "success") {
          window.location.href = "/";
        }
        else {
          var errosbox = "<div class='ui negative message'><div class='header'>錯誤</div><ul class='list'>";
          for (var i in response) {
            var dom = "<li>" + response[i].msg + "</li>";
            errosbox += dom;
          }
          errosbox += "</ul></div>";
          $('#new .modal-body').prepend(errosbox);
          $('#new').data('bs.modal').handleUpdate();
        }
      }
    });
  });

  $('#recommand .scorebtn').on('click',function(){
    $('#recommand .scorebtn').css('background','white');
    $(this).css('background','#D8D8D8');
    var rate = this.getAttribute("data-score");
    $('input[name=recommand]').val(rate);
  })

  $('#hard .scorebtn').on('click',function(){
    $('#hard .scorebtn').css('background','white');
    $(this).css('background','#D8D8D8');
    var rate = this.getAttribute("data-score");
    $('input[name=hard]').val(rate);
  })

  $('#sweet .scorebtn').on('click',function(){
    $('#sweet .scorebtn').css('background','white');
    $(this).css('background','#D8D8D8');
    var rate = this.getAttribute("data-score");
    $('input[name=sweet]').val(rate);
  })
});
</script>
